#!/bin/sh

NC="\033[0m"
RED="\033[1;31m"
YELLOW="\033[0;33m"

CACHE="/tmp/search-yt"
INSTANCE="https://invidious.snopyta.org/search?q="

QUERY="$( echo $@ | sed 's| |+|g' )"

# TODO fix the cache dir
curl -s "$INSTANCE$QUERY" |
  awk -F '[<>]' \
    -v QUOTE="'" -v DQUOTE=\" \
      '/href="\/watch.*<\/a>/ {
          gsub(/&#39;/,QUOTE); gsub(/&quot;/,DQUOTE);
          print $5; print $4 > "/tmp/lmao"
      } /length">/ { LENGTH=$3 
      } /views$/ {
          gsub(/\s{2,}/,"");
          print "[" ++count "]" "-> " $0 \
            " | " LENGTH } '

# i'll try to use this format
# printf -- "\033[1;31m\nCommand Line App For Downloading YouTube Videos\n" && printf "\033[0;33m[1]-> DistroTub | 14:59 | 21K views | 1 year ago\n\n"

# old script for reference
  # awk -F '[<>]' -v CACHE="${CACHE}" \
  #   ' ( NF > 1 ) { print $2 } /views/ {\
  #   gsub(/\s{2,}/,""); print "[" ++count "]" "-> " $0 } /watch/ {\
  #   print $1 > CACHE } '
